10 N9=15
20 C0=1/298.26
30 A0=-1
40 PI=4.*ATN(1)
50 TP=PI+PI
60 RD=PI/180
70 G$(1)=""
80 GOTO 390
90 REM @PRESS_ANY_KEY
100 FOR C=1 TO 9
110 C$=INKEY$
120 NEXT C
130 PRINT
140 PRINT "Press any key to continue."
150 REM @KEYPRESS
160 C$=INKEY$
170 IF C$="" THEN GOTO 160
180 RETURN
190 REM @MATH_1
200 X=INT(M0*X+.5)/M0
210 RETURN
220 REM @MATH_2
230 P=129.04398/T-.40758+.645765438E-3*T
240 RETURN
250 REM @MATH_3
260 P=2.7412979/T-.32774624-3*T
270 RETURN
280 REM @KEYPRESS_CAPITALIZED
290 C$=INKEY$
300 IF C$="" THEN GOTO 290
310 C=ASC(C$)
320 C$=CHR$(C+32*(C>90))
330 FOR C=1 TO LEN(C0$)
340 IF C$=MID$(C0$,C,1) THEN RETURN
350 NEXT C
360 GOTO 290
370 CLS
380 REM @PRINT_OPTIONS
390 PRINT "1-LORAN FIX      6-TWO PT HEAD & DIST"
400 PRINT "2-ALT. SOLUTION  7-CALIBRATE"
410 PRINT "3-DEST LAT/LON   8-NEW STA. IDs"
420 PRINT "4-HEAD & DIST    9-ASF Correction"
430 PRINT "5-PREDICT ITDs   A-STOP"
440 PRINT
450 PRINT "OPTION?"
460 C0$="123456789A"
470 GOSUB 290
480 CLS
490 ON C GOSUB 2980,3140,3340,3450,3630,3210,4030,540,4500,1590
500 GOTO 390
510 REM @CHECK_GRI
520 IF G1$<>"" THEN RETURN
530 REM @OPT_8_NEW_STA_IDS
540 F0=1
550 N=1
560 CLS
570 INPUT "1st GRI";I$
580 GOSUB 1090
590 GOSUB 1160
600 IF F0=2 THEN GOTO 540
610 REM @INPUT_GRI_2
620 F0=1
630 N=2
640 INPUT "2nd GRI";I$
650 GOSUB 1090
660 IF A$=I9$ THEN GOSUB 1360:IF F0=1 THEN GOTO 700
670 GOSUB 1160
680 IF F0=2 THEN GOTO 620
690 REM @SET_F1_F2
700 F1=1
710 F2=1
720 IF G1$=G2$ THEN GOTO 1090
730 IF P(1,1)=P(1,2) AND L(1,1)+L(1,2) THEN GOTO 850
740 F2=-1
750 IF P(1,1)=P(2,2) AND L(1,1)+L(2,2) THEN GOTO 850
760 F1=-1
770 IF P(2,1)=P(2,2) AND L(2,1)+L(2,2) THEN GOTO 850
780 F2=2
790 IF P(2,1)=P(1,2) AND L(2,1)+L(1,2) THEN GOTO 850
800 REM @GRI_ERROR
810 PRINT "ERROR: NO TRIPLET."
820 GOSUB 100
830 GOTO 540
840 REM @DO_WORK
850 PRINT
860 PRINT "Working"
870 FOR I=1 TO 2
880 P1=P(1,I)
890 L1=L(1,I)
900 P2=P(2,I)
910 L2=L(2,I)
920 GOSUB 980
930 NEXT I
940 G(1)=0
950 G(2)=0
960 RETURN
970 REM @SETUP_VARIABLES
980 GOSUB 1980
990 B(I)=S0
1000 Z(1,I)=Z1
1010 Z(2,I)=Z2
1020 REM @MATH_4
1030 T=21282.3593*S0
1040 IF T>=537 THEN GOSUB 230
1050 IF T<537 THEN GOSUB 260
1060 T(I)=T+P
1070 RETURN
1080 REM @PARSE_GRI
1090 L=LEN(I$)
1100 A$=LEFT$(I$,L-1)
1110 B$=RIGHT$(I$,1)
1120 B=ASC(B$)
1130 B$=CHR$(B+32*(B>90))
1140 RETURN
1150 REM @READ_DATA_RESET
1160 N8=1
1170 RESTORE
1180 REM @READ_DATA
1190 READ I9$,N0,P0,L0
1200 FOR I=1 TO N0
1210 READ W$(I),D9(I),P1(I),L1(I)
1220 NEXT I
1230 IF I9$<>A$ THEN GOTO 1280
1240 GOSUB 1360
1250 IF F0=2 THEN GOTO 1310
1260 RETURN
1270 REM @INCREMENT_INDEX
1280 N8=N8+1
1290 IF N8<=N9 THEN GOTO 1190
1300 REM @ERROR_CHAIN_NOT_FOUND
1310 PRINT I$;" IS NOT CATALOGED"
1320 F0=2
1330 GOSUB 100
1340 RETURN
1350 REM @PROCESS_STATIONS
1360 FOR I=1 TO N0
1370 IF W$(I)=B$ THEN GOTO 1420
1380 NEXT I
1390 F0=2
1400 RETURN
1410 REM @SET_GRI_1_2
1420 IF N=1 THEN G1$=I$:G$(1)=I$
1430 IF N=2 THEN G2$=I$:G$(2)=I$
1440 D(N)=D9(I)
1450 X=P0
1460 GOSUB 4750
1470 P(1,N)=X
1480 X=L0
1490 GOSUB 4640
1500 L(1,N)=V*RD
1510 X=P1(I)
1520 GOSUB 4750
1530 P(2,N)=X
1540 X=L1(I)
1550 GOSUB 4640
1560 L(2,N)=V*RD
1570 RETURN
1580 REM @EXIT
1590 END
1600 REM @DIRECT_SOLUTION
1610 Z8=SIN(Z1)
1620 Z9=COS(Z1)
1630 P8=SIN(P1)
1640 P9=COS(P1)
1650 M=-Z8*P9
1660 C1=C0*M
1670 C2=C0*(1-M*M)/4
1680 D=(1-C2)*(1-C2-C1*M)
1690 P=C2*(1+C1*M/2)/D
1700 N=P9*Z9
1710 YY=N
1720 XX=P8
1730 GOSUB 4290
1740 S1=AN
1750 D0=S0/D
1760 U=2*(S1-D0)
1770 W=1-2*P*COS(U)
1780 V=COS(U+D0)
1790 X=C2*C2*SIN(D0)*COS(D0*(2*V*V-1))
1800 Y=2*P*V*W*SIN(D0)
1810 S2=D0+X-Y
1820 S8=SIN(S2)
1830 S9=COS(S2)
1840 K=SQR(M*M+(N*S9-P8*S8)^2)
1850 P2=ATN((P8*S9+N*S8)/K)
1860 YY=-S8*Z8
1870 XX=P9*S9-P8*S8*Z9
1880 GOSUB 4290
1890 S3=AN
1900 H=C1*(1-C2)*S2-C1*C2*S8*COS(S1+S1-S2)
1910 L2=L1+S3-H
1920 YY=-M
1930 XX=-(N*S9-P8*S8)
1940 GOSUB 4290
1950 Z2=AN
1960 RETURN
1970 REM @REVERSE_SOLUTION
1980 L3=L2-L1
1990 P3=(P2-P1)/2
2000 P4=(P1+P2)/2
2010 P6=SIN(P3)
2020 P7=COS(P3)
2030 P8=SIN(P4)
2040 P9=COS(P4)
2050 H=P7*P7-P8*P8
2060 L=P6*P6+H*SIN(L3/2)^2
2070 XX=SQR(L)
2080 GOSUB 4570
2090 D0=2*AN
2100 U=2*P8*P8*P7*P7/(1-L)
2110 V=2*P6*P6*P9*P9/L
2120 X=U+V
2130 Y=U-V
2140 T=D0/SIN(D0)
2150 D=4*T*T
2160 E=2*COS(D0)
2170 A=D*E
2180 C=T-(A-E)/2
2190 N1=X*(A+C*X)
2200 B=D+D
2210 N2=Y*(B+E*Y)
2220 N3=D*X*Y
2230 D2=C0*C0*(N1-N2+N3)/64
2240 D1=C0*(T*X-Y)/4
2250 S0=(T-D1+D2)*SIN(D0)
2260 M=32*T-(20*T-A)*X-(B+4)*Y
2270 F=Y+Y-E*(4-X)
2280 G=C0*(T/2+C0*M/64)
2290 Q=-F*G*TAN(L3)/4
2300 L4=(L3+Q)/2
2310 L8=SIN(L4)
2320 L9=COS(L4)
2330 YY=P6*L9
2340 XX=P9*L8
2350 GOSUB 4290
2360 T1=AN
2370 YY=-P7*L9
2380 XX=P8*L8
2390 GOSUB 4290
2400 T2=AN
2410 M0=TP
2420 X=T1+T2
2430 GOSUB 4270
2440 Z1=X
2450 X=T1-T2
2460 GOSUB 4270
2470 Z2=X
2480 RETURN
2490 REM @FIXING_ROUTINE
2500 A1=F1*SIN(A(1))
2510 B1=COS(A(1))-COS(B(1))
2520 C1=SIN(B(1))
2530 A2=F2*SIN(A(2))
2540 B2=COS(A(2))-COS(B(2))
2550 C2=SIN(B(2))
2560 E1=Z(1,1)
2570 IF F1=-1 THEN E1=Z(2,1)
2580 E2=Z(1,2)
2590 IF F2=-1 THEN E2=Z(2,2)
2600 C=B1*C2*COS(E2)-B2*C1*COS(E1)
2610 S=B1*C2*SIN(E2)-B2*C1*SIN(E1)
2620 K=B2*A1-B1*A2
2630 R=SQR(C*C+S*S)
2640 YY=S
2650 XX=C
2660 GOSUB 4290
2670 G=AN
2680 XX=K/R
2690 GOSUB 4610
2700 Z=G+A0*AN
2710 YY=B2
2720 XX=C2*COS(Z-E2)+A2
2730 GOSUB 4290
2740 S0=AN
2750 IF F2=1 THEN P1=P(1,2):L1=L(1,2)
2760 IF F2=-1 THEN P1=P(2,2):L1=L(2,2)
2770 Z1=Z
2780 GOSUB 1610
2790 P0=P2
2800 L0=L2
2810 P=ATN(TAN(P0)/(1-C0))
2820 P=P/RD
2830 X=L0/RD
2840 M0=360
2850 GOSUB 4270
2860 L=X
2870 IF L>180 THEN L=L-360
2880 X=P
2890 GOSUB 4350
2900 P$=C$
2910 X=L
2920 GOSUB 4350
2930 PRINT
2940 PRINT "LAT  = ";P$
2950 PRINT "LONG = ";C$
2960 RETURN
2970 REM @OPT_1_ENTER_ITDS
2980 GOSUB 520
2990 CLS
3000 FOR I=1 TO 2
3010 PRINT "ITD FOR ";G$(I);
3020 INPUT A
3030 A=A+G(I)-D(I)-T(I)
3040 IF ABS(A)<T(I) THEN GOTO 3080
3050 PRINT "ITD NOT VALID FOR ";G$(I)
3060 GOSUB 100
3070 REM @ITD_VALID_CONTINUE
3080 A(I)=A/21295.8736
3090 NEXT I
3100 GOSUB 2500
3110 GOSUB 100
3120 RETURN
3130 REM @OPT_2_ALT_SOLUTION
3140 IF A0=1 THEN A0=-1:GOTO 3170
3150 A0=0
3160 REM @SKIP_SET_A0
3170 GOSUB 2500
3180 GOSUB 100
3190 RETURN
3200 REM @OPT_6_TWO_POINT_HEAD_DIST
3210 CLS
3220 INPUT "ORIGIN LAT    dd.mmss ";P
3230 INPUT "ORIGIN LONG   ddd.mmss";L
3240 X=P
3250 GOSUB 4750
3260 P0=X
3270 X=L
3280 GOSUB 4640
3290 L0=V*RD
3300 GOSUB 3340
3310 GOSUB 3450
3320 RETURN
3330 REM @OPT_3_INPUT_DEST_LL
3340 CLS
3350 INPUT "DEST LAT      dd.mmss";P
3360 INPUT "DEST LONG     ddd.mmss";L
3370 X=P
3380 GOSUB 4750
3390 P5=X
3400 X=L
3410 GOSUB 4640
3420 L5=V*RD
3430 RETURN
3440 REM @OPT_4_HEAD_DIST_TO_DEST
3450 P1=P0
3460 L1=L0
3470 P2=P5
3480 L2=L5
3490 GOSUB 1980
3500 M0=360
3510 X=Z1/RD
3520 GOSUB 4270
3530 GOSUB 4350
3540 CLS
3550 PRINT "HEADING = ";C$
3560 M0=100
3570 X=3443.917*S0
3580 GOSUB 200
3590 PRINT "DISTANCE = ";X;" n. mi."
3600 GOSUB 100
3610 RETURN
3620 REM @OPT_5_PREDICT_ITDS
3630 GOSUB 520
3640 GOSUB 3920
3650 PRINT
3660 FOR K=1 TO 2
3670 I9=T(K)+D(K)
3680 P2=P(2,K)
3690 L2=L(2,K)
3700 GOSUB 1980
3710 I=3
3720 GOSUB 1030
3730 I9=I9+T(3)
3740 P2=P(1,K)
3750 L2=L(1,K)
3760 GOSUB 1980
3770 I=3
3780 GOSUB 1030
3790 I9=I9-T(3)
3800 M0=100
3810 X=I9
3820 GOSUB 200
3830 1130 PRINT "ITD FOR ";G$(K);" = ";X
3840 NEXT K
3850 PRINT
3860 PRINT "New lat/long or Return to menu?"
3870 C0$="NR"
3880 GOSUB 290
3890 IF C=1 THEN GOTO 3630
3900 RETURN
3910 REM @INPUT_LAT_LON_DM
3920 CLS
3930 INPUT "LAT dd.mmss";P1
3940 INPUT "LONG ddd.mmss";L1
3950 X=P1
3960 GOSUB 4750
3970 P1=X
3980 X=L1
3990 GOSUB 4640
4000 L1=V*RD
4010 RETURN
4020 REM @OPT_7_CALIBRATE
4030 GOSUB 520
4040 GOSUB 3920
4050 FOR K=1 TO 2
4060 I$=G1$
4070 IF K=2 THEN I$=G2$
4080 CLS
4090 PRINT "ITD FOR ";I$;
4100 INPUT I9
4110 I9=I9-D(K)
4120 P2=P(2,K)
4130 L2=L(2,K)
4140 GOSUB 1980
4150 I=3
4160 GOSUB 1030
4170 I9=I9-T(3)
4180 P2=P(1,K)
4190 L2=L(1,K)
4200 GOSUB 1980
4210 I=3
4220 GOSUB 1030
4230 T(K)=I9+T(3)+G(K)
4240 NEXT K
4250 RETURN
4260 REM @MOD_FN_SETUP
4270 X=X-M0*INT(X/M0)
4280 REM @MOD_FN
4290 AN=ATN(YY/(XX-1E-9*(XX=0)))-PI*(XX<0)
4300 RETURN
4310 REM @QATN
4320 X=ATN((1-C0)*TAN(X))
4330 RETURN
4340 REM @BUILD_STRING
4350 C$=" "
4360 IF X<0 THEN C$="-":X=-X
4370 X=X+1/7200
4380 X0=INT(X)
4390 C$=C$+STR$(X0)+" "
4400 X=60*(X-X0)
4410 X0=INT(X)
4420 X$=STR$(100+X0)
4430 C$=C$+RIGHT$(X$,2)+" "
4440 X=60*(X-X0)
4450 X0=INT(X)
4460 X$=STR$(100+X0)
4470 C$=C$+RIGHT$(X$,2)+" "
4480 RETURN
4490 REM @OPT_9_ASF_CORRECTIONS
4500 GOSUB 520
4510 CLS
4520 PRINT "ASF FOR ";G$(1);INPUT G(1)
4530 PRINT "ASF FOR ";G$(2);
4540 INPUT G(2)
4550 RETURN
4560 REM @SET_ZZ_AND_AN
4570 ZZ=SQR(1-XX*XX)
4580 AN=ATN(XX/(ZZ-1E-9*(ZZ=0)))
4590 RETURN
4600 REM @ASIN
4610 AN=ATN(SQR(1-XX*XX)/(XX-1E-9*(XX=0)))-PI*(XX<0)
4620 RETURN
4630 REM @ACOS
4640 S=SGN(X)
4650 X=ABS(X)
4660 H=INT(X)
4670 M0=1
4680 GOSUB 4270
4690 V=X*100
4700 X=V
4710 GOSUB 4270
4720 V=S*((100*X/60+INT(V))/60+H)
4730 RETURN
4740 REM @USE_ACOS_QATN
4750 GOSUB 4640
4760 X=V*RD
4770 GOSUB 4320
4780 RETURN
4790 DATA "4990",2,16.444395,169.30312,"X",11000,20.144916,155.53097
4800 DATA "Y",29000,28.234177,178.17302
4810 DATA "5930",2,46.4827199,67.5537713,"X",11000,41.151193,69.583909
4820 DATA "Y",25000,46.46463218,53.102816
4830 DATA "5970",3,36.1105797,-129.2027279,"W",11000,42.4437104,-143.4309245
4840 DATA "X",31000,35.0223871,-126.322674,"Z",42000,263624975,-128.0856445
4850 DATA "5990",3,51.575878,122.220224,"X",11000,55.2620851,131.1519648
4860 DATA "Y",27000,47.034799,119.443953,"Z",41000,50.3629731,127.2129043
4870 DATA "7930",3,59.591727,45.102747,"W",11000,64.542658,23.552175
4880 DATA "X",21000,62.175964,7.042658,"Z",43000,46.463218,53.102816
4890 DATA "*7930",3,24.1707888,-153.5853232,"X",11000,42.4437104,-143.4309245
4900 DATA "Y",30000,26.3624975,-128.856445,"Z",49000,9.3245789,-138.095497
4910 DATA "7960",2,63.1942814,142.48319,"X",11000,57.262021,152.2211225
4920 DATA "Y",26000,55.2620851,131.1519648
4930 DATA "7970",4,62.175964,7.0426538,"W",26000,54.4829872,-8.1736312
4940 DATA "X",11000,68.380615,-14.2747,"Y",46000,64.542658,23.552175
4950 DATA "Z",60000,70.545261,8.435869
4960 DATA "7980",4,30.593874,85.1009305,"W",11000,30.4333018,90.49436
4970 DATA "X",23000,26.3155006,97.5000093,"Y",43000,27.0158393,80.0653429
4980 DATA "Z",59000,34.0346081,77.5446654
4990 DATA "7990",3,38.5220587,-16.4306159,"X",11000,35.3120787,-12.3130245
5000 DATA "Y",29000,40.582095,-27.520152,"Z",47000,42.0336515,-3.1215512
5010 DATA "8970",3,39.510754,87.291214,"W",11000,30.593874,85.1009305
5020 DATA "X",28000,42.4250603,76.4933862,"Y",44000,48.3649844,94.331846
5030 DATA "9940",3,39.3306621,118.495637,"W",11000,47.034799,119.443953
5040 DATA "X",27000,38.465699,122.2944529,"Y",40000,35.191818,114.4817435
5050 DATA "9960",4,42.4250603,76.4933862,"W",11000,46.4827199,67.5537713
5060 DATA "X",25000,41.151193,69.583909,"Y",39000,34.0346081,77.5446654
5070 DATA "Z",54000,39.510754,87.291214
5080 DATA "9970",4,24.4803597,-141.1930303,"W",11000,24.1707888,-153.5853232
5090 DATA "X",30000,42.4437104,-143.4309245,"Y",55000,26.3624975,-128.0856445
5100 DATA "Z",75000,9.3245789,-138.095497
5110 DATA "9990",3,57.091265,17.1506789,"X",11000,52.494404,-173.1048974
5120 DATA "Y",29000,65.1440306,166.531255,"Z",43000,57.262021,152.2211225