10 REM LORAN-C ROUTINE. REV 07-15-83. 1530 HOURS
20 N9=15
30 REM N9=NO. OF MASTER STATIONS
40 C0=1/298.26
50 A0=-1
60 PI=4.*ATN(1)
70 TP=PI+PI
80 RD=PI/180
90 G$(1)=""
100 GOTO 120
110 FOR C=1 TO 9
120 C$=INKEY$
130 NEXT C
140 PRINT
150 PRINT "Press any key to continue."
160 C$=INKEY$
170 IF C$="" GOTO 34
180 RETURN
190 X=INT(M0*X+.5)/M0
200 RETURN
210 P=129.04398/T-.40758+.645765438E-3*T
220 RETURN
230 P=2.7412979/T-.32774624-3*T
240 RETURN
250 C$=INKEY$
260 IF C$="" GOTO 70
270 C=ASC(C$)
280 C$=CHR$(C+32*(C>90))
290 FOR C=1 TO LEN(C0$)
300 IF C$=MID$(C0$,C,1) THEN RETURN
310 NEXT C
320 GOTO 70
330 CLS
340 PRINT "1-LORAN FIX      6-TWO PT HEAD & DIST"
350 PRINT "2-ALT. SOLUTION  7-CALIBRATE"
360 PRINT "3-DEST LAT/LON   8-NEW STA. IDs"
370 PRINT "4-HEAD & DIST    9-ASF Correction"
380 PRINT "5-PREDICT ITDs   A-STOP"
390 PRINT
400 PRINT "OPTION?"
410 C0$="123456789A"
420 GOSUB 70
430 CLS
440 ON C GOSUB 910,950,1010,1040,1090,990,1200,190,1320,530
450 GOTO 120
460 IF G1$<>"" THEN RETURN
470 F0=1
480 N=1
490 CLS
500 INPUT "1st GRI";I$
510 GOSUB 380
520 GOSUB 390
530 IF F0=2 GOTO 190
540 F0=1
550 N=2
560 INPUT "2nd GRI";I$
570 GOSUB 380
580 IF A$=I9$ THEN GOSUB 470
590 IF F0=1 GOTO 250
600 GOSUB 390
610 IF F0=2 GOTO 210
620 F1=1
630 F2=1
640 IF G1$=G2$ GOTO 300
650 IF P(1,1)=P(1,2) AND L(1,1)+L(1,2) GOTO 310
660 F2=-1
670 IF P(1,1)=P(2,2) AND L(1,1)+L(2,2) GOTO 310
680 F1=-1
690 IF P(2,1)=P(2,2) AND L(2,1)+L(2,2) GOTO 310
700 F2=2
710 IF P(2,1)=P(1,2) AND L(2,1)+L(1,2) GOTO 310
720 PRINT "ERROR NO TRIPLET."
730 REM A
740 GOSUB 32
750 GOTO 190
760 PRINT
770 PRINT "Working"
780 FOR I=1 TO 2
790 P1=P(1,I)
800 L1=L(1,I)
810 P2=P(2,I)
820 L2=L(2,I)
830 GOSUB 330
840 NEXT I
850 G(1)=0
860 G(2)=0
870 RETURN
880 GOSUB 650
890 B(I)=S0
800 Z(1,I)=Z1
910 Z(2,I)=Z2
920 T=21282.3593*S0
930 IF T>=537 THEN GOSUB 50
940 IF T<537 THEN GOSUB 60
950 T(I)=T+P
960 RETURN
970 L=LEN(I$)
980 A$=LEFT$(I$,L-1)
990 B$=RIGHT$(I$,1)
1000 B=ASC(B$)
1010 B$=CHR$(B+32*(B>90))
1020 RETURN
1030 N8=1
1040 RESTORE
1050 READ I9$,N0,P0,L0
1060 FOR I=1 TO N0
1070 READ W$(I),D9(I),P1(I),L1(I)
1080 NEXT I
1090 IF I9$<>A$ GOTO 450
1100 GOSUB 470
1110 IF F0=2 GOTO 460
1120 RETURN
1130 N8=N8+1
1140 IF N8<=N9 GOTO 400
1150 PRINT I$;" IS NOT CATALOGED"
1160 F0=2
1170 GOSUB 32
1180 RETURN
1190 FOR I=1 TO N0
1200 IF W$(I)=B$ GOTO 490
1210 NEXT I
1220 F0=2
1230 RETURN
1240 IF N=1 THEN G1$=I$
1250 G$(1)=I$
1260 IF N=2 THEN G2$=I$
1270 G$(2)=I$
1280 D(N)=D9(I)
1290 X=P0
1300 GOSUB 1370
1310 P(1,N)=X
1320 X=L0
1330 GOSUB 1360
1340 L(1,N)=V*RD
1350 X=P1(I)
1360 GOSUB 1370
1370 P(2,N)=X
1380 X=L1(I)
1390 GOSUB 1360
1400 L(2,N)=V*RD
1410 RETURN
1420 END
1430 REM DIRECT SOLUTION
1440 Z8=SIN(Z1)
1450 Z9=COS(Z1)
1460 P8=SIN(P1)
1470 P9=COS(P1)
1480 M=-Z8*P9
1490 C1=C0*M
1500 C2=C0*(1-M*M)/4
1510 D=(1-C2)*(1-C2-C1*M)
1520 P=C2*(1+C1*M/2)/D
1530 N=P9*Z9
1540 YY=N
1550 XX=P8
1560 GOSUB 1260
1570 S1=AN
1580 D0=S0/D
1590 U=2*(S1-D0)
1600 W=1-2*P*COS(U)
1610 V=COS(U+D0)
1620 X=C2*C2*SIN(D0)*COS(D0*(2*V*V-1))
1630 Y=2*P*V*W*SIN(D0)
1640 S2=D0+X-Y
1650 S8=SIN(S2)
1660 S9=COS(S2)
1670 K=SQR(M*M+(N*S9-P8*S8)^2)
1680 P2=ATN((P8*S9+N*S8)/K)
1690 YY=-S8*Z8
1700 XX=P9*S9-P8*S8*Z9
1710 GOSUB 1260
1720 S3=AN
1730 H=C1*(1-C2)*S2-C1*C2*S8*COS(S1+S1-S2)
1740 L2=L1+S3-H
1750 YY=-M
1760 XX=-(N*S9-P8*S8)
1770 GOSUB 1260
1780 Z2=AN
1790 RETURN
1800 REM REVERSE SOLN
1810 L3=L2-L1
1820 P3=(P2-P1)/2
1830 P4=(P1+P2)/2
1840 P6=SIN(P3)
1850 P7=COS(P3)
1860 P8=SIN(P4)
1870 P9=COS(P4)
1880 H=P7*P7-P8*P8
1890 L=P6*P6+H*SIN(L3/2)^2
1800 XX=SQR(L)
1910 GOSUB 1340
1920 D0=2*AN
1930 U=2*P8*P8*P7*P7/(1-L)
1940 V=2*P6*P6*P9*P9/L
1950 X=U+V
1960 Y=U-V
1970 T=D0/SIN(D0)
1980 D=4*T*T
1990 E=2*COS(D0)
2000 A=D*E
2010 C=T-(A-E)/2
2020 N1=X*(A+C*X)
2030 B=D+D
2040 N2=Y*(B+E*Y)
2050 N3=D*X*Y
2060 D2=C0*C0*(N1-N2+N3)/64
2070 D1=C0*(T*X-Y)/4
2080 S0=(T-D1+D2)*SIN(D0)
2090 M=32*T-(20*T-A)*X-(B+4)*Y
2100 F=Y+Y-E*(4-X)
2110 G=C0*(T/2+C0*M/64)
2120 Q=-F*G*TAN(L3)/4
2130 L4=(L3+Q)/2
2140 L8=SIN(L4)
2150 L9=COS(L4)
2160 YY=P6*L9
2170 XX=P9*L8
2180 GOSUB 1260
2190 T1=AN
2200 YY=-P7*L9
2210 XX=P8*L8
2220 GOSUB 1260
2230 T2=AN
2240 M0=TP
2250 X=T1+T2
2260 GOSUB 1250
2270 Z1=X
2280 X=T1-T2
2290 GOSUB 1250
2300 Z2=X
2310 RETURN
2320 REM FIXING ROUTINE
2330 A1=F1*SIN(A(1))
2340 B1=COS(A(1))-COS(B(1))
2350 C1=SIN(B(1))
2360 A2=F2*SIN(A(2))
2370 B2=COS(A(2))-COS(B(2))
2380 C2=SIN(B(2))
2390 E1=Z(1,1)
2400 IF F1=-1 THEN E1=Z(2,1)
2410 E2=Z(1,2)
2420 IF F2=-1 THEN E2=Z(2,2)
2430 C=B1*C2*COS(E2)-B2*C1*COS(E1)
2440 S=B1*C2*SIN(E2)-B2*C1*SIN(E1)
2450 K=B2*A1-B1*A2
2460 R=SQR(C*C+S*S)
2470 YY=S
2480 XX=C
2490 GOSUB 1260
2500 G=AN
2510 XX=K/R
2520 GOSUB 1350
2530 Z=G+A0*AN
2540 YY=B2
2550 XX=C2*COS(Z-E2)+A2
2560 GOSUB 1260
2570 S0=AN
2580 IF F2=1 THEN P1=P(1,2)
2590 L1=L(1,2)
2600 IF F2=-1 THEN P1=P(2,2)
2610 L1=L(2,2)
2620 Z1=Z
2630 GOSUB 550
2640 P0=P2
2650 L0=L2
2660 P=ATN(TAN(P0)/(1-C0))
2670 P=P/RD
2680 X=L0/RD
2690 M0=360
2700 GOSUB 1250
2710 L=X
2720 IF L>180 THEN L=L-360
2730 X=P
2740 GOSUB 1280
2750 P$=C$
2760 X=L
2770 GOSUB 1280
2780 PRINT
2790 PRINT "LAT  = ";P$
2800 PRINT "LONG = ";C$
2810 RETURN
2820 REM OPT 1
2830 GOSUB 185
2840 CLS
2850 FOR I=1 TO 2
2860 PRINT "ITD FOR ";G$(I);
2870 INPUT A
2880 A=A+G(I)-D(I)-T(I)
2890 IF ABS(A)<T(I) GOTO 940
2800 PRINT "ITD NOT VALID FOR ";G$(I)
2910 GOSUB 32
2920 A(I)=A/21295.8736
2930 NEXT I
2940 GOSUB 770
2950 GOSUB 32
2960 RETURN
2970 REM OPT 2
2980 IF A0=1 THEN A0=-1
2990 GOTO 970
3000 A0=1
3010 GOSUB 770
3020 GOSUB 32
3030 RETURN
3040 REM OPT 6
3050 CLS
3060 INPUT "ORIGIN LAT    dd.mmss ";P
3070 INPUT "ORIGIN LONG   ddd.mmss";L
3080 X=P
3090 GOSUB 1370
3100 P0=X
3110 X=L
3120 GOSUB 1360
3130 L0=V*RD
3140 GOSUB 1010
3150 GOSUB 1040
3160 RETURN
3170 CLS
3180 INPUT "DEST LAT      dd.mmss";P
3190 INPUT "DEST LONG     ddd.mmss";L
3200 X=P
3210 GOSUB 1370
3220 P5=X
3230 X=L
3240 GOSUB 1360
3250 L5=V*RD
3260 RETURN
3270 REM OPT 4
3280 P1=P0
3290 L1=L0
3300 P2=P5
3310 L2=L5
3320 GOSUB 650
3330 M0=360
3340 X=Z1/RD
3350 GOSUB 1250
3360 GOSUB 1280
3370 CLS
3380 PRINT "HEADING = ";C$
3390 M0=100
3400 X=3443.917*S0
3410 GOSUB 40
3420 PRINT "DISTANCE = ";X;" n. mi."
3430 GOSUB 32
3440 RETURN
3450 REM OPT 5
3460 GOSUB 185
3470 GOSUB 1170
3480 PRINT
3490 FOR K=1 TO 2
3500 I9=T(K)+D(K)
3510 P2=P(2,K)
3520 L2=L(2,K)
3530 GOSUB 650
3540 I=3
3550 GOSUB 340
3560 I9=I9+T(3)
3570 P2=P(1,K)
3580 L2=L(1,K)
3590 GOSUB 650
3600 I=3
3610 GOSUB 340
3620 I9=I9-T(3)
3630 M0=100
3640 X=I9
3650 GOSUB 40
3660 PRINT "ITD FOR ";G$(K);" = ";X
3670 NEXT K
3680 PRINT
3690 PRINT "New lat/long or Return to menu?"
3700 C0$="NR"
3710 GOSUB 70
3720 IF C=1 GOTO 1090
3730 RETURN
3740 CLS
3750 INPUT "LAT dd.mmss";P1
3760 INPUT "LONG ddd.mmss";L1
3770 X=P1
3780 GOSUB 1370
3790 P1=X
3800 X=L1
3810 GOSUB 1360
3820 L1=V*RD
3830 RETURN
3840 REM OPT 7
3850 GOSUB 185
3860 GOSUB 1170
3870 FOR K=1 TO 2
3880 I$=G1$
3890 IF K=2 THEN I$=G2$
3800 CLS
3910 PRINT "ITD FOR ";I$;
3920 INPUT I9
3930 I9=I9-D(K)
3940 P2=P(2,K)
3950 L2=L(2,K)
3960 GOSUB 650
3970 I=3
3980 GOSUB 340
3990 I9=I9-T(3)
4000 P2=P(1,K)
4010 L2=L(1,K)
4020 GOSUB 650
4030 I=3
4040 GOSUB 340
4050 T(K)=I9+T(3)+G(K)
4060 NEXT K
4070 RETURN
4080 X=X-M0*INT(X/M0)
4090 REM MOD FCTN
4100 AN=ATN(YY/(XX-1E-9*(XX=0)))-PI*(XX<0)
4110 RETURN
4120 REM QATN
4130 X=ATN((1-C0)*TAN(X))
4140 RETURN
4150 C$=" "
4160 IF X<0 THEN C$="-"
4170 X=-X
4180 X=X+1/7200
4190 X0=INT(X)
4200 C$=C$+STR$(X0)+" "
4210 X=60*(X-X0)
4220 X0=INT(X)
4230 X$=STR$(100+X0)
4240 C$=C$+RIGHT$(X$,2)+" "
4250 X=60*(X-X0)
4260 X0=INT(X)
4270 X$=STR$(100+X0)
4280 C$=C$+RIGHT$(X$,2)+" "
4290 RETURN
4300 GOSUB 185
4310 CLS
4320 PRINT "ASF FOR ";G$(1);INPUT G(1)
4330 PRINT "ASF FOR ";G$(2);
4340 INPUT G(2)
4350 RETURN
4360 ZZ=SQR(1-XX*XX)
4370 AN=ATN(XX/(ZZ-1E-9*(ZZ=0)))
4380 RETURN
4390 REM ASIN
4400 AN=ATN(SQR(1-XX*XX)/(XX-1E-9*(XX=0)))-PI*(XX<0)
4410 RETURN
4420 REM ACOS
4430 S=SGN(X)
4440 X=ABS(X)
4450 H=INT(X)
4460 M0=1
4470 GOSUB 1250
4480 V=X*100
4490 X=V
4500 GOSUB 1250
4510 V=S*((100*X/60+INT(V))/60+H)
4520 RETURN
4530 GOSUB 1360
4540 X=V*RD
4550 GOSUB 1270
4560 RETURN
5000 DATA "4990",2,16.444395,169.30312,"X",11000,20.144916,155.53097
5010 DATA "Y",29000,28.234177,178.17302
5020 DATA "5930",2,46.4827199,67.5537713,"X",11000,41.151193,69.583909
5030 DATA "Y",25000,46.46463218,53.102816
5040 DATA "5970",3,36.1105797,-129.2027279,"W",11000,42.4437104,-143.4309245
5050 DATA "X",31000,35.0223871,-126.322674,"Z",42000,263624975,-128.0856445
5060 DATA "5990",3,51.575878,122.220224,"X",11000,55.2620851,131.1519648
5070 DATA "Y",27000,47.034799,119.443953,"Z",41000,50.3629731,127.2129043
5080 DATA "7930",3,59.591727,45.102747,"W",11000,64.542658,23.552175
5090 DATA "X",21000,62.175964,7.042658,"Z",43000,46.463218,53.102816
5100 DATA "*7930",3,24.1707888,-153.5853232,"X",11000,42.4437104,-143.4309245
5110 DATA "Y",30000,26.3624975,-128.856445,"Z",49000,9.3245789,-138.095497
5120 DATA "7960",2,63.1942814,142.48319,"X",11000,57.262021,152.2211225
5130 DATA "Y",26000,55.2620851,131.1519648
5140 DATA "7970",4,62.175964,7.0426538,"W",26000,54.4829872,-8.1736312
5150 DATA "X",11000,68.380615,-14.2747,"Y",46000,64.542658,23.552175
5160 DATA "Z",60000,70.545261,8.435869
5170 DATA "7980",4,30.593874,85.1009305,"W",11000,30.4333018,90.49436
5180 DATA "X",23000,26.3155006,97.5000093,"Y",43000,27.0158393,80.0653429
5190 DATA "Z",59000,34.0346081,77.5446654
5100 DATA "7990",3,38.5220587,-16.4306159,"X",11000,35.3120787,-12.3130245
5110 DATA "Y",29000,40.582095,-27.520152,"Z",47000,42.0336515,-3.1215512
5120 DATA "8970",3,39.510754,87.291214,"W",11000,30.593874,85.1009305
5130 DATA "X",28000,42.4250603,76.4933862,"Y",44000,48.3649844,94.331846
5140 DATA "9940",3,39.3306621,118.495637,"W",11000,47.034799,119.443953
5150 DATA "X",27000,38.465699,122.2944529,"Y",40000,35.191818,114.4817435
5160 DATA "9960",4,42.4250603,76.4933862,"W",11000,46.4827199,67.5537713
5170 DATA "X",25000,41.151193,69.583909,"Y",39000,34.0346081,77.5446654
5180 DATA "Z",54000,39.510754,87.291214
5190 DATA "9970",4,24.4803597,-141.1930303,"W",11000,24.1707888,-153.5853232
5100 DATA "X",30000,42.4437104,-143.4309245,"Y",55000,26.3624975,-128.0856445
5110 DATA "Z",75000,9.3245789,-138.095497
5120 DATA "9990",3,57.091265,17.1506789,"X",11000,52.494404,-173.1048974
5130 DATA "Y",29000,65.1440306,166.531255,"Z",43000,57.262021,152.2211225